<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
    <link rel="stylesheet" href="../css/teste.css">

    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        .student-info {
            margin-top: 26px;
            border-radius: 9px;
            position: absolute;
            margin-right: 9%;
            top: 0;
            width: 200px;
            height: 73%; /* Ajuste a altura conforme necessário */
            background-color: #1a75c4;
            color: white;
            padding: 15px;
            display: none; /* Oculta a aba inicialmente */
            z-index: 1051; /* Aumente o z-index para ser maior que o modal */
            transition: right 0.3s ease-in-out;
        }
        
        
        .student-info.show {
            display: block;
            right: 0;
        }
        
        .modal-content {
            position: relative;
            z-index: 1040; /* Certifique-se de que o z-index do modal é menor que o do card */
        }
        
        .navbar { 
            background-color: #1a75c4;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            height: 50px;
        }
        .navbar a {
            color: white;
        }
        .suggestions {
            border: 1px solid #ddd;
            border-radius: 9px;
            max-height: 150px;
            overflow-y: auto;
            position: absolute;
            background: white;
            width: 85%;
        }
        .suggestions div {
            padding: 10px;
            cursor: pointer;
        }
        .suggestions div:hover {
            background-color: #f0f0f0;
        }
        
    </style>
</head>

<body>
    
    <main>
        <header>
            <div class="wrapper">
                <div class="menu-desktop">
                    <button onclick="abrirmenu()" id="btn-menu">
                        <span class="linha"></span>
                        <span class="linha"></span>
                        <span class="linha"></span>
                    </button>
                    <nav>
                        <ul>
                            <li><a href="#">home</a></li>
                            <li><a href="#">home</a></li>
                            <li><a href="#">home</a></li>
                            <li><a href="#">home</a></li>
                            <li><a href="#" data-bs-toggle="modal" data-bs-target="#userModal">Criar Ocorrencia</a></li>
                        </ul>
                    </nav>  
                </div>

                <div class="menu-mobile" id="menu-mobile">
                    <nav>
                        <ul>
                            <li><a href="#">home</a></li>
                            <li><a href="#">home</a></li>
                            <li><a href="#">home</a></li>
                            <li><a href="#">home</a></li>
                            <li><a href="#" data-bs-toggle="modal" data-bs-target="#userModal">Criar Ocorrencia</a></li>
                        </ul>
                    </nav>  
                </div>
                <div class="container">
                    <div class="texto-inicio">
                        <p>Oi, seja bem-vindo XXXXXX</p>
                        <h3>Pagina inicial</h3>
                    </div>
                    <div class="caixas">
                        <div class="horizontal">
                            <div class="box-dadosRecentes">
                                <h3>Dados Recentes</h3>
                                <p>Esta é uma caixa grande</p>
                            </div>
                            <div class="box-AlunosAlerta">
                                <h3>Alunos em Alerta</h3>
                                <p>Esta é uma caixa pequena</p>
                            </div>
                        </div>
                        <div class="box-ocorrenciasPendentes">
                            <h3>Ocorrências</h3>
                            <h3>Pendentes</h3>
                            <p>Esta é uma caixa pequena</p>
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </main>

    <!-- Modal -->
    <div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">Formulário de Cadastro</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="userForm">
                        <div class="mb-3">
                            <div class="input-group">
                                <input type="text" class="form-control" id="matricula" placeholder="" required>
                                <span class="input-group-text" id="botaoPesquisa"><i class="bi bi-search"></i></span>
                            </div>
                            <div class="suggestions" id="sugestaoMatriculas"></div>
                        </div>
  
                        <div class="mb-3">
                            <label for="relato" class="form-label">Relato do funcionário</label>
                            <textarea class="form-control" id="relato" rows="2" placeholder="" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="conduta" class="form-label">Arquivo' opcional'</label>
                            <input type="text" class="form-control" id="conduta" placeholder="" required>
                        </div>

                        <button type="submit" class="btn btn-primary" id="botaoOk">Enviar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <div id="studentInfo" class="student-info">

    </div>

    <script>
        const botaoPesquisa = document.getElementById('botaoPesquisa');
        const sugestaoMatriculas = document.getElementById('sugestaoMatriculas');
        const matriculaAluno = document.getElementById("matricula");
        const botaoOk = document.getElementById("botaoOk")
        const divCardAluno = document.getElementById("studentInfo")

        
        matriculaAluno.addEventListener('input', function () {
            const query = matriculaAluno.value; 
            sugestaoMatriculas.innerHTML = '';

            if (query) {
                let uri_get_matriculas = `/alunos/matriculas/${query}`;
                fetch(uri_get_matriculas, {
                    method: 'get',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                })
                .then((response) => response.json())
                .then((data) => {
                    processarResultados(data);
                })
                .catch((error) => {
                    console.error("Error:", error);
                });
            }
        });

        function processarResultados (resultadojson) {
            console.log('resultadojson',resultadojson)
            if (resultadojson) {
                resultadojson.matriculas.forEach(obj => {
                    const matricula = obj.matricula;
                    const div = document.createElement('div');
                    div.textContent = matricula;
                    div.addEventListener('click', function () {
                        matriculaAluno.value = matricula;
                        sugestaoMatriculas.innerHTML = '';
                    });
                    sugestaoMatriculas.appendChild(div);
                });
            }
        }
       
        botaoPesquisa.onclick = function ()  {
            criarAbaAluno()
        }

        function criarAbaAluno () {
            console.log(matriculaAluno.value)

            let uri_get_aluno = `/alunos/${matriculaAluno.value}`;
                fetch(uri_get_aluno, {
                    method: 'get',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                })
                .then((response) => response.json())
                .then((data) => {
                    processarDadosAlunos(data);
                })
                .catch((error) => {
                    console.error("Error:", error);
                });
            const studentInfo = document.getElementById('studentInfo');
            studentInfo.classList.add('show');
        }

        function processarDadosAlunos (resultadojson) {
            console.log(resultadojson)
            if (resultadojson) {
                const studentInfo = document.getElementById('studentInfo');
                studentInfo.innerHTML = '';
                const nome = document.createElement("p");
                nome.textContent = `Nome Completo: ${resultadojson.nome}`;
                
                const turma = document.createElement("p");
                turma.textContent = `Turma: ${resultadojson.turma}`;
                
                //const curso = document.createElement("p");
                //curso.textContent = `Curso: ${resultadojson.matricula.curso}`;

                const ocorerencias = document.createElement("p");
                ocorerencias.textContent = `Ocorrências: ${resultadojson.turma}`;

                const advertencias = document.createElement("p");
                advertencias.textContent = `Advertências: ${resultadojson.turma}`;
                
                const suspensao = document.createElement("p");
                suspensao.textContent = `Suspensão: ${resultadojson.turma}`;

                studentInfo.appendChild(nome);
                studentInfo.appendChild(turma);
                //studentInfo.appendChild(curso);
                studentInfo.appendChild(ocorerencias);
                studentInfo.appendChild(advertencias);
                studentInfo.appendChild(suspensao);

            }
        }

        botaoOk.onclick = function ()  {
            criarOcorrencia()
        }

        function criarOcorrencia () {
            const horarioClique = new Date();
            const matricula = matriculaAluno.value
            console.log("Horário do clique:", horarioClique);
            console.log("MAtricula do aluno selecionada : ", matricula)
        }
        
    </script>

    <script>
        const menuDiv = document.getElementById("menu-mobile");
        const btnAnimar = document.getElementById("btn-menu");

        btnAnimar.addEventListener('click', function () {
            menuDiv.classList.toggle('abrir');
            btnAnimar.classList.toggle('ativo');
        });
    </script>
</body>
</html>
